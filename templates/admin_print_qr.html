{% extends "base.html" %}

{% block title %}Друк QR-кодів{% endblock %}

{% block head_extra %}
<style>
    .qr-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 16px;
    }
    .qr-item {
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 8px;
        background: #fff;
        text-align: center;
        page-break-inside: avoid;
    }
    .qr-label {
        font-size: 12px;
        margin-top: 4px;
    }
    .qr-small img {
        width: 80px;
        height: 80px;
    }
    .qr-medium img {
        width: 120px;
        height: 120px;
    }
    .qr-large img {
        width: 180px;
        height: 180px;
    }
    @media print {
        header, .toolbar, .btn, .muted {
            display: none !important;
        }
        body {
            background: #fff;
        }
        main {
            margin: 0;
            max-width: none;
        }
        .card {
            box-shadow: none;
            border: none;
            margin: 0;
            padding: 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<h1>Пакетний друк QR-кодів</h1>

<div class="card">
    <h2 style="margin-top:0;">Вибір локації та розміру</h2>
    <form method="get" class="toolbar">
        <div>
            <label>Локація</label><br>
            <select name="location_id" required>
                <option value="">Оберіть локацію</option>
                {% for loc in locations %}
                    <option value="{{ loc.id }}"
                        {% if selected_location_id == loc.id %}selected{% endif %}>
                        {{ loc.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label>Розмір QR-коду</label><br>
            <select name="size">
                <option value="small" {% if size == 'small' %}selected{% endif %}>Малий</option>
                <option value="medium" {% if size == 'medium' %}selected{% endif %}>Середній</option>
                <option value="large" {% if size == 'large' %}selected{% endif %}>Великий</option>
            </select>
        </div>
        <div class="toolbar-right">
            <button class="btn btn-primary" type="submit">Показати QR-коди</button>
            {% if containers %}
                <button class="btn btn-secondary" type="button" onclick="window.print();">
                    Друкувати
                </button>
            {% endif %}
        </div>
    </form>
    <p class="muted" style="margin-top:8px;">
        Оберіть шафу/локацію та натисніть "Показати QR-коди", після цього можна друкувати аркуш.
    </p>
</div>

{% if containers is not none %}
    <div class="card">
        {% if not containers %}
            <p class="muted">У вибраній локації немає ємностей.</p>
        {% else %}
            <h2 style="margin-top:0;">
                QR-коди для локації:
                {% for loc in locations %}
                    {% if loc.id == selected_location_id %}
                        {{ loc.name }}
                    {% endif %}
                {% endfor %}
            </h2>
            <div class="qr-grid">
                {% for c in containers %}
                    <div class="qr-item qr-{{ size }}">
                        <img src="{{ url_for('container_qr', container_id=c.id) }}" alt="QR">
                        <div class="qr-label">
                            QR для ємності:<br>
                            <strong>{{ c.material_code }} – {{ c.material_name }}</strong><br>
                            <span class="muted">{{ c.location_name }}</span>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endif %}
{% endblock %}
