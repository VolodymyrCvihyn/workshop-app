{% extends "base.html" %}

{% block title %}Працівники{% endblock %}

{% block content %}
<h1>Працівники</h1>

<div class="card">
    <h2 style="margin-top:0;">Додати працівника</h2>
    <form method="post">
        <input type="hidden" name="action" value="add">
        <div style="margin-bottom:8px;">
            <label for="name">Імʼя / прізвище</label><br>
            <input type="text" id="name" name="name" required>
        </div>
        <div style="margin-bottom:8px;">
            <label for="pin">PIN (необовʼязково)</label><br>
            <input type="text" id="pin" name="pin" placeholder="Наприклад, 1234">
            <div class="muted">PIN можна використовувати для швидкого вибору працівника при списанні.</div>
        </div>
        <button class="btn btn-primary" type="submit">Додати</button>
    </form>
</div>

<div class="card">
    <h2 style="margin-top:0;">Список працівників</h2>

    {% if not workers %}
        <p class="muted">Ще не додано жодного працівника.</p>
    {% else %}
        <div style="overflow-x:auto;">
            <table>
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Імʼя</th>
                    <th>PIN</th>
                    <th>Логін</th>
                    <th>Операції</th>
                    <th>Дії</th>
                </tr>
                </thead>
                <tbody>
                {% for w in workers %}
                    <tr>
                        <td>{{ w.id }}</td>
                        <td>
                            <!-- Редагування імені -->
                            <form method="post" class="inline" style="margin:0;">
                                <input type="hidden" name="action" value="edit_name">
                                <input type="hidden" name="worker_id" value="{{ w.id }}">
                                <input type="text" name="name" value="{{ w.name }}" style="min-width:140px;">
                                <button class="btn btn-secondary btn-sm" type="submit">Зберегти</button>
                            </form>
                        </td>
                        <td>
                            <!-- Оновлення PIN -->
                            <form method="post" class="inline" style="margin:0;">
                                <input type="hidden" name="action" value="update_pin">
                                <input type="hidden" name="worker_id" value="{{ w.id }}">
                                <input type="text" name="pin" value="{{ w.pin or '' }}" style="width:80px;">
                                <button class="btn btn-secondary btn-sm" type="submit">OK</button>
                            </form>
                        </td>
                        <td>
                            {% if w.username %}
                                <div>
                                    <span>{{ w.username }}</span>
                                </div>
                                <!-- Зміна пароля -->
                                <form method="post" class="inline" style="margin-top:4px;">
                                    <input type="hidden" name="action" value="change_user_password">
                                    <input type="hidden" name="worker_id" value="{{ w.id }}">
                                    <input type="password" name="password" placeholder="Новий пароль" style="width:120px;">
                                    <button class="btn btn-secondary btn-sm" type="submit">Змінити пароль</button>
                                </form>
                            {% else %}
                                <!-- Створення логіну -->
                                <form method="post" class="inline" style="margin:0;">
                                    <input type="hidden" name="action" value="create_user">
                                    <input type="hidden" name="worker_id" value="{{ w.id }}">
                                    <input type="text" name="username" placeholder="Логін" style="width:110px;">
                                    <input type="password" name="password" placeholder="Пароль" style="width:110px;">
                                    <button class="btn btn-primary btn-sm" type="submit">Створити</button>
                                </form>
                            {% endif %}
                        </td>
                        <td>
                            <a class="btn btn-secondary btn-sm"
                               href="{{ url_for('goto_worker_transactions', worker_id=w.id) }}">
                                Журнал операцій
                            </a>
                        </td>
                        <td>
                            <!-- Видалення працівника -->
                            <form method="post"
                                  class="inline"
                                  action="{{ url_for('delete_worker', worker_id=w.id) }}"
                                  onsubmit="return confirm('Видалити працівника {{ w.name }}? Операції залишаться, але без привʼязки до нього.');">
                                <button class="btn btn-danger btn-sm" type="submit">Видалити</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
</div>
{% endblock %}
