{% extends "base.html" %}

{% block title %}Пошук{% endblock %}

{% block content %}
<h1>Пошук</h1>

<div class="card">
    <form method="get">
        <label>Пошуковий запит</label><br>
        <input type="text" name="q" value="{{ q or '' }}" style="min-width:260px;"
               placeholder="код або назва матеріалу, назва локації, ...">
        <button class="btn btn-primary" type="submit">Шукати</button>
    </form>
    <p class="muted" style="margin-top:6px;">
        Пошук виконується по матеріалах, локаціях та ємностях.
    </p>
</div>

{% if q %}
    <div class="card">
        <h2 style="margin-top:0;">Матеріали</h2>
        {% if not materials %}
            <p class="muted">Нічого не знайдено.</p>
        {% else %}
            <ul>
                {% for m in materials %}
                    <li>
                        <strong>{{ m.code }}</strong> – {{ m.name }} ({{ m.unit }})
                        &nbsp;–&nbsp;
                        <a href="{{ url_for('goto_material_containers', material_id=m.id) }}">
                            ємності матеріалу
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    <div class="card">
        <h2 style="margin-top:0;">Локації</h2>
        {% if not locations %}
            <p class="muted">Нічого не знайдено.</p>
        {% else %}
            <ul>
                {% for loc in locations %}
                    <li>
                        <strong>{{ loc.name }}</strong>
                        &nbsp;–&nbsp;
                        <a href="{{ url_for('admin_containers', location_id=loc.id) }}">
                            ємності цієї локації
                        </a>
                    </li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>

    <div class="card">
        <h2 style="margin-top:0;">Ємності</h2>
        {% if not containers %}
            <p class="muted">Нічого не знайдено.</p>
        {% else %}
            <div style="overflow-x:auto;">
                <table>
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Матеріал</th>
                        <th>Локація</th>
                        <th>Залишок</th>
                        <th>Од. виміру</th>
                        <th>Дії</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for c in containers %}
                        <tr>
                            <td>{{ c.id }}</td>
                            <td>{{ c.material_code }} – {{ c.material_name }}</td>
                            <td>{{ c.location_name }}</td>
                            <td>{{ '%.3f'|format(c.balance|float) }}</td>
                            <td>{{ c.material_unit }}</td>
                            <td>
                                <a class="btn btn-secondary btn-sm"
                                   href="{{ url_for('container_history', container_id=c.id) }}">
                                    Історія
                                </a>
                                <a class="btn btn-secondary btn-sm"
                                   href="{{ url_for('admin_containers', material_id=c.material_id) }}">
                                    Ємності матеріалу
                                </a>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        {% endif %}
    </div>
{% endif %}
{% endblock %}
