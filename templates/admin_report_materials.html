{% extends "base.html" %}

{% block title %}Звіт по матеріалах{% endblock %}

{% block content %}
<h1>Звіт: використання матеріалів</h1>

<div class="card">
    <h2 style="margin-top:0;">Фільтр</h2>
    <form method="get" class="toolbar">
        <div>
            <label>Дата з</label><br>
            <input type="date" name="date_from" value="{{ filters.date_from or '' }}">
        </div>
        <div>
            <label>Дата по</label><br>
            <input type="date" name="date_to" value="{{ filters.date_to or '' }}">
        </div>
        <div>
            <label>Працівник</label><br>
            <select name="worker_id">
                <option value="">(усі)</option>
                {% for w in workers %}
                    <option value="{{ w.id }}"
                        {% if selected_worker_id == w.id %}selected{% endif %}>
                        {{ w.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="toolbar-right">
            <button class="btn btn-secondary btn-sm" type="submit">Застосувати</button>
        </div>
    </form>
    <p class="muted" style="margin-top:6px;">
        У звіті враховуються лише операції <strong>OUT (списання)</strong>.
    </p>
</div>

<div class="card">
    <h2 style="margin-top:0;">Результат</h2>
    {% if not rows %}
        <p class="muted">За вибраним фільтром даних немає.</p>
    {% else %}
        <div style="overflow-x:auto;">
            <table>
                <thead>
                <tr>
                    <th>Матеріал</th>
                    <th>Од. виміру</th>
                    <th>Всього списано</th>
                </tr>
                </thead>
                <tbody>
                {% for r in rows %}
                    <tr>
                        <td>{{ r.material_code }} – {{ r.material_name }}</td>
                        <td>{{ r.material_unit }}</td>
                        <td>{{ '%.3f'|format(r.total_qty|float) }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
</div>
{% endblock %}
